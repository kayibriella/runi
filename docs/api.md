# API Documentation

## Overview
The API is automatically generated by Convex and provides type-safe endpoints for all queries, mutations, and actions defined in the backend. The API enables frontend components to interact with backend functions seamlessly.

## API Generation
- Automatically generated from Convex schema and functions
- Type definitions created in `convex/_generated/`
- Client SDK provided by Convex for React integration

## Core API Concepts

### Queries
Used for fetching data from the backend:

```typescript
// Example usage in a React component
const products = useQuery(api.products.list);
const user = useQuery(api.users.get, { userId: "123" });
```

Available queries by module:
- `api.auth.loggedInUser`: Get currently logged in user
- `api.dashboard.getStats`: Get dashboard statistics
- `api.expenseCategories.list`: List all expense categories
- `api.expenses.list`: List all expenses
- `api.files.list`: List files in a folder
- `api.folders.list`: List all folders
- `api.productCategories.list`: List all product categories
- `api.products.list`: List all products
- `api.sales.list`: List all sales
- `api.sales.listAudit`: List sales audit logs
- `api.staff.list`: List all staff members
- `api.deposit.list`: List all deposits
- `api.settings.get`: Get user settings
- `api.users.get`: Get user profile

### Mutations
Used for modifying data on the backend:

```typescript
// Example usage in a React component
const { mutate: createProduct, status } = useMutation(api.products.create);
const { mutateAsync: updateSettings } = useMutation(api.settings.update);

// Call mutation
createProduct({
  name: "New Product",
  price: 29.99
});
```

Available mutations by module:
- `api.expenseCategories.create`: Create new expense category
- `api.expenseCategories.update`: Update expense category
- `api.expenseCategories.delete`: Delete expense category
- `api.expenses.create`: Create new expense
- `api.expenses.update`: Update expense
- `api.expenses.delete`: Delete expense
- `api.files.upload`: Upload a file
- `api.files.delete`: Delete a file
- `api.folders.create`: Create new folder
- `api.folders.update`: Update folder
- `api.folders.delete`: Delete folder
- `api.productCategories.create`: Create new product category
- `api.productCategories.update`: Update product category
- `api.productCategories.delete`: Delete product category
- `api.products.create`: Create new product
- `api.products.update`: Update product
- `api.products.delete`: Delete product
- `api.sales.create`: Create new sale
- `api.sales.update`: Update sale
- `api.sales.delete`: Delete sale
- `api.sales.approve`: Approve sale modification
- `api.staff.create`: Register new staff member
- `api.staff.update`: Update staff details
- `api.staff.toggleStatus`: Activate/Deactivate staff
- `api.deposit.create`: Record new deposit
- `api.deposit.updateStatus`: Approve/Reject deposit
- `api.settings.update`: Update user settings

### Actions
Used for complex operations that may take longer or interact with external services:

```typescript
// Example usage in a React component
const { mutateAsync: sendNotification } = useAction(api.notifications.send);

await sendNotification({
  userId: "123",
  message: "Hello World"
});
```

Available actions:
- Authentication actions in `api.auth`

### HTTP Endpoints
Public HTTP endpoints for external integrations:

- `POST /api/sendReceipt`: Send receipt for a transaction
- `GET /api/health`: Health check endpoint
- Webhook endpoints for third-party services

## Error Handling
API errors are automatically handled by the Convex client:
- Network errors are retried automatically
- Authentication errors redirect to login
- Validation errors are returned to the client
- Server errors are logged and appropriate HTTP codes returned

## Real-time Updates
Queries automatically subscribe to real-time updates:
- When underlying data changes, queries re-run automatically
- Components re-render with updated data
- No manual polling required

## Type Safety
- Full TypeScript support
- Auto-generated type definitions
- Compile-time checking of API calls
- IntelliSense support in IDEs

## Rate Limiting
- API calls are rate-limited to prevent abuse
- Excessive requests result in 429 status codes
- Retry logic built into client SDK

## Authentication
- All API calls automatically include authentication tokens
- Unauthenticated calls to protected endpoints are rejected
- Token refresh handled automatically